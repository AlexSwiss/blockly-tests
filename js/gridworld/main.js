!function t(e,n,o){function i(r,s){if(!n[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=n[r]={exports:{}};e[r][0].call(c.exports,function(t){var n=e[r][1][t];return i(n?n:t)},c,c.exports,t,e,n,o)}return n[r].exports}for(var a="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(t,e,n){!function(e,n,o){var i,a=(t("./game-blocks.js"),t("./game.js")),r=t("./interpreter.js"),s=t("./ui.js"),l=t("./rules.js"),c=0,u=o.Xml.textToDom('<xml><block type="gridworld_start" deletable="false" moveble="false" x="200" y="10"></block></xml>'),d=function(){o.mainWorkspace.traceOn(!0),o.mainWorkspace.highlightBlock(null);var t=o.mainWorkspace.getTopBlocks();if(t.length>1)return void s.toggleDialog(!0,"Oops! Make sure all of your blocks are connected to the start block.","warning");if(null===t[0].nextConnection.targetConnection)return void s.toggleDialog(!0,"Oops! Drag blocks to the workspace and attach them to the start block to write code","warning");o.JavaScript.init(o.mainWorkspace);var e=o.JavaScript.blockToCode(t[0]);l.enact(i.rules),s.toggleOverlay(!0,!1),s.toggleButton("gobutton",!1),s.toggleButton("resetbutton",!0),r.start(e,p)},p=function(t){t&&s.toggleOverlay(!1),l.getFlags().win&&!i.last&&s.toggleButton("nextbutton",!0)},f=function(){i=a.setLevel(c);for(var t="",e=0,n=i.blocks.length;n>e;e++)t+='<block type="'+i.blocks[e]+'"></block>';o.updateToolbox("<xml>"+t+"</xml>"),o.mainWorkspace.clear(),o.mainWorkspace.maxBlocks="max_blocks"in i?i.max_blocks+1:1/0,o.Xml.domToWorkspace(o.mainWorkspace,u),s.setGoal(i.goal),s.toggleButton("gobutton",!0),s.toggleButton("nextbutton",!1),s.toggleButton("resetbutton",!1)};window.onload=function(){s.setButtonHandler("gobutton",d),s.setButtonHandler("resetbutton",f),s.setButtonHandler("nextbutton",function(){c+=1,f()}),a.init(s.phaser,"zombie"),r.init(a),l.init(a,r,s),a.start(),o.inject(s.blockly,{toolbox:"<xml></xml>"}),o.addChangeListener(function(){s.setBlocksLeft(o.mainWorkspace.remainingCapacity())}),a.gameReady.add(function(){f()})}}(e,n,Blockly)},{"./game-blocks.js":2,"./game.js":3,"./interpreter.js":4,"./rules.js":5,"./ui.js":6}],2:[function(t,e,n){!function(t,e,n){n.JavaScript.STATEMENT_PREFIX="highlightBlock(%1);\n",n.JavaScript.addReservedWords("highlightBlock"),n.Blocks.gridworld_gonorth={init:function(){this.setColour(320),this.appendDummyInput().appendField("go north"),this.setTooltip("Move north (towards the top of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_gonorth=function(){return"walkNorth();\n"},n.Blocks.gridworld_gosouth={init:function(){this.setColour(320),this.appendDummyInput().appendField("go south"),this.setTooltip("Move south (towards the bottom of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_gosouth=function(){return"walkSouth();\n"},n.Blocks.gridworld_goeast={init:function(){this.setColour(320),this.appendDummyInput().appendField("go east"),this.setTooltip("Move east (towards the right side of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_goeast=function(){return"walkEast();\n"},n.Blocks.gridworld_gowest={init:function(){this.setColour(320),this.appendDummyInput().appendField("go west"),this.setTooltip("Move west (towards the left side of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_gowest=function(){return"walkWest();\n"},n.Blocks.gridworld_goforward={init:function(){this.setColour(320),this.appendDummyInput().appendField("go forward"),this.setTooltip("Move forward without changing facing"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_goforward=function(){return"walkForward();\n"},n.Blocks.gridworld_turnright={init:function(){this.setColour(320),this.appendDummyInput().appendField("turn right"),this.setTooltip("Turn 90 degrees to the right"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_turnright=function(){return"turnRight();\n"},n.Blocks.gridworld_turnleft={init:function(){this.setColour(320),this.appendDummyInput().appendField("turn left"),this.setTooltip("Turn 90 degrees to the left"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_turnleft=function(){return"turnLeft();\n"},n.Blocks.gridworld_facenorth={init:function(){this.setColour(320),this.appendDummyInput().appendField("face north"),this.setTooltip("Face north (towards the top of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_facenorth=function(){return"faceNorth();\n"},n.Blocks.gridworld_facesouth={init:function(){this.setColour(320),this.appendDummyInput().appendField("face south"),this.setTooltip("Face south (towards the bottom of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_facesouth=function(){return"faceSouth();\n"},n.Blocks.gridworld_faceeast={init:function(){this.setColour(320),this.appendDummyInput().appendField("face east"),this.setTooltip("Face east (towards the right side of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_faceeast=function(){return"faceEast();\n"},n.Blocks.gridworld_facewest={init:function(){this.setColour(320),this.appendDummyInput().appendField("face west"),this.setTooltip("Face west (towards the left side of the screen)"),this.setNextStatement(!0),this.setPreviousStatement(!0)}},n.JavaScript.gridworld_facewest=function(){return"faceWest();\n"},n.Blocks.gridworld_start={init:function(){this.setColour(240),this.appendDummyInput().appendField("when the program starts"),this.setTooltip("Attach blocks here"),this.setNextStatement(!0),this.setPreviousStatement(!1),this.setDeletable(!1),this.setMovable(!1)}},n.JavaScript.gridworld_start=function(){return"/* Start */\n"}}(e,n,Blockly)},{}],3:[function(t,e,n){!function(t,e,n){var o,i,a,r,s,l,c,u,d,p=48,f=12,h=12,g="assets/gridworld/",m=Object.create(n.State.prototype);m.preload=function(){a.load.spritesheet("progbar",g+"progbar-ss.png",400,50),a.load.json("config",g+"config-"+o+".json")},m.create=function(){i=a.cache.getJSON("config"),a.state.start("preload")};var w=Object.create(n.State.prototype);w.preload=function(){var t=a.add.sprite(a.world.centerX-200,a.world.centerY,"progbar");t.anchor.setTo(0,.5),t.animations.add("spin",[0,1,2,3],12,!0),t.animations.play("spin"),a.load.setPreloadSprite(t,0);var e=a.add.text(a.world.centerX,a.world.centerY-30,"Loading....",{font:"36px Arial",fill:"white"});e.anchor.setTo(.5,1);var o=a.add.text(a.world.centerX,a.world.centerY,"0%",{font:"36px Arial",fill:"white"});o.anchor.setTo(.5,.5),a.load.onFileComplete.add(function(t){o.setText(t+"%")},this),a.load.spritesheet("player",g+i.url_prefix+i.player.spritesheet,i.player.width,i.player.height),a.load.image("tiles",g+i.url_prefix+i.tilesets.main),a.load.image("features",g+i.url_prefix+i.tilesets.features);for(var r=0,s=i.levels.length;s>r;r++)a.load.tilemap("level"+r,g+i.url_prefix+i.levels[r].map,null,n.Tilemap.TILED_JSON)},w.create=function(){a.state.start("play")};var y=Object.create(n.State.prototype);y.create=function(){r=a.add.sprite(0,0,"player");for(var t=["walk_s","stand_s","walk_e","stand_e","walk_n","stand_n","walk_w","stand_w"],n=0,o=t.length;o>n;n++){var s=t[n];r.animations.add(s,i.player.animations[s].frames,i.player.animations[s].fps,!0)}e.gameReady.dispatch()},e.getFeatureProperties=function(){var t=s.getTileWorldXY(r.x,r.y,p,p,"Features");return t?t.properties:{}},e.setFacing=function(t){u=t,r.animations.play("stand_"+u)};var v=["n","e","s","w"],k={n:0,e:1,s:2,w:3};e.turn=function(t){var n=(k[u]+t)%4;e.actionStart("turn"),0>n&&(n=(n+4)%4),u=v[n],r.animations.play("stand_"+u),e.actionFinish.dispatch("turn")},e.walkForward=function(){e.walk(u)},e.walk=function(t){switch(d=!1,e.actionStart.dispatch("walk"),t){case"n":var n=0,o=-1,l={y:r.y+o*p};break;case"s":n=0,o=1,l={y:r.y+o*p};break;case"e":n=1,o=0,l={x:r.x+n*p};break;case"w":n=-1,o=0,l={x:r.x+n*p}}var c=s.getTileWorldXY(r.x+n*p,r.y+o*p,p,p,"Ground");if(c&&"true"!==c.properties.blocker){var u=a.add.tween(r);u.to(l,i.player.speed),r.animations.play("walk_"+t),u.onComplete.add(function(){r.animations.play("stand_"+t);var n=e.getFeatureProperties();Object.keys(n).length>0&&e.featureSeen.dispatch(n),e.actionFinish.dispatch("walk")},this),u.start()}else if(e.collision.dispatch(),d)e.actionFinish.dispatch("walk");else{r.animations.play("walk_"+t);var f=a.time.create(!0);f.add(i.player.speed,function(){r.animations.play("stand_"+t),e.actionFinish.dispatch("walk")}),f.start()}},e.cancelAction=function(){d=!0},e.init=function(t,i){o=i,a=new n.Game(f*p,h*p,n.AUTO,t),a.state.add("boot",m),a.state.add("preload",w),a.state.add("play",y),e.gameReady=new n.Signal,e.collision=new n.Signal,e.actionFinish=new n.Signal,e.actionStart=new n.Signal,e.featureSeen=new n.Signal},e.start=function(){a.state.start("boot")},e.togglePaused=function(t){a.paused=t},e.resetLevel=function(t){var e=i.levels[t];u=e.facing,r.x=i.player.offset_x+p*e.start_x,r.y=i.player.offset_y+p*e.start_y,r.animations.play("stand_"+u),r.bringToTop()},e.setLevel=function(t){var n=i.levels[t];return t===i.levels.length-1&&(n.last=!0),s&&(s.destroy(),l.destroy(),c.destroy()),s=a.add.tilemap("level"+t),s.addTilesetImage("Ground","tiles"),s.addTilesetImage("Features","features"),l=s.createLayer("Ground"),c=s.createLayer("Features"),e.resetLevel(t),n}}(e,n,Phaser)},{}],4:[function(t,e,n){!function(t,e,n,o){var i,a,r,s,l,c=10,u="function walkNorth() {\nwalk('n');\nwait();\n}\nfunction walkSouth() {\nwalk('s');\nwait();\n}\nfunction walkEast() {\nwalk('e');\nwait();\n}\nfunction walkWest() {\nwalk('w');\nwait();\n}\nfunction walkForward() {\nwalkForwardInternal();\nwait();\n}\nfunction faceNorth() {\nsetFacing('n');\n}\nfunction faceEast() {\nsetFacing('e');\n}\nfunction faceSouth() {\nsetFacing('s');\n}\nfunction faceWest() {\nsetFacing('w');\n}\nfunction turnRight() {\nturn(1);\n}\nfunction turnLeft() {\nturn(-1);\n}\n",d=function(t,e){var n=function(e){return t.createPrimitive(r.walk(e.toString()))};t.setProperty(e,"walk",t.createNativeFunction(n)),n=function(){return r.collision.dispatch()},t.setProperty(e,"reportCollision",t.createNativeFunction(n)),n=function(){var t=r.getFeatureProperties();Object.keys(t).length>0&&r.features.dispatch(t)},t.setProperty(e,"reportFeatures",t.createNativeFunction(n)),n=function(){a=!0,r.actionFinish.addOnce(function(){setTimeout(p,0)})},t.setProperty(e,"wait",t.createNativeFunction(n)),n=function(t){t=t?t.toString():"",o.mainWorkspace.highlightBlock(t)},t.setProperty(e,"highlightBlock",t.createNativeFunction(n)),n=function(t){r.setFacing(t.toString())},t.setProperty(e,"setFacing",t.createNativeFunction(n)),n=function(t){r.turn(t.toNumber())},t.setProperty(e,"turn",t.createNativeFunction(n)),n=function(){return t.createPrimitive(r.walkForward())},t.setProperty(e,"walkForwardInternal",t.createNativeFunction(n))};e.init=function(t){r=t};var p=function(){return i?(a=!1,void(s.step()?a||setTimeout(p,c):l&&l(!0))):void(l&&l(!1))};e.start=function(t,e){l=e,i=!0,s=new n(u+t,d),setTimeout(p,0)},e.pause=function(){a=!0},e.resume=function(){setTimeout(p,0)},e.stop=function(){i=!1}}(e,n,Interpreter,Blockly)},{}],5:[function(t,e,n){!function(t){var e,n,o,i,a=[];t.enact=function(t){for(var r=0,s=a.length;s>r;r++)a[r].detach();i={},t.collision&&(t.collision.interrupt&&a.push(e.collision.add(function(){e.cancelAction()})),t.collision.failure&&a.push(e.collision.add(function(){e.actionFinish.addOnce(function(){o.stop(),n.toggleDialog(!0,t.collision.message,function(){n.toggleOverlay(!1)})})}))),t.goal&&a.push(e.featureSeen.add(function(a){a.type===t.goal.type&&(i.win=!0,e.actionFinish.addOnce(function(){o.stop(),n.toggleDialog(!0,t.goal.message,function(){n.toggleOverlay(!1)})}))}))},t.getFlags=function(){return i},t.init=function(t,i,a){e=t,o=i,n=a}}(n,e)},{}],6:[function(t,e,n){!function(t,e){var n,o=document.getElementById("goal"),i=document.getElementById("blocksleft"),a=function(){var t=document.createElement("div");return t.style.width="100%",t.style.height="100%",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.zIndex=1e3,t.style.backgroundColor="black",t.style.opacity="0.0",t.style.display="none",document.body.appendChild(t),t},r=function(){var t=document.createElement("div");t.style.position="absolute",t.style.zIndex="2000",t.style.display="none";var n=document.createElement("div");n.className="content",t.appendChild(n);var o=document.createElement("hr");t.appendChild(o);var i=document.createElement("button");return i.className="greenbutton",i.onclick=function(){e.toggleDialog(!1)},i.innerHTML="OK",t.appendChild(i),document.body.appendChild(t),t},s=a(),l=r(),c=null;e.toggleOverlay=function(t,e){n=t,t?(s.style.opacity=e?"0.5":"0",s.style.display="block"):s.style.display="none"},e.toggleDialog=function(t,o,i,a){t?("function"==typeof i?c=i:"string"==typeof i&&(a=i),e.toggleOverlay(!0,!0),l.style.display="block",l.firstChild.innerHTML=o,l.className=a?"gridworld-dialog theme-dialog "+a:"gridworld-dialog theme-dialog",setTimeout(function(){l.style.top=(window.innerHeight-l.offsetHeight)/2+"px",l.style.left=(window.innerWidth-l.offsetWidth)/2+"px"},0)):(e.toggleOverlay(n,!1),l.style.display="none",c&&(c(),c=null))},e.setButtonHandler=function(t,e){document.getElementById(t).onclick=e},e.toggleButton=function(t,e){document.getElementById(t).style.display=e?"block":"none"},e.setGoal=function(t){o.innerHTML=t},e.setBlocksLeft=function(t){1/0===t&&(t="&infin;"),i.innerHTML=t},e.blockly=document.getElementById("blockly"),e.phaser=document.getElementById("phaser")}(e,n)},{}]},{},[1]);